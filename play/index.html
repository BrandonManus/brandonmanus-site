<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SKY ODYSSEY â€“ Epic Flying Minigame</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
    font-family: 'Courier New', monospace;
    user-select: none;
  }

  canvas { display: block; width: 100%; height: 100%; }

  #hud {
    position: absolute; top: 15px; left: 15px;
    color: #0f0; font-size: 16px;
    text-shadow: 0 0 8px #0f0, 0 0 16px #0f0;
    letter-spacing: 1px; pointer-events: none; z-index: 10;
  }
  #score { position: absolute; top: 15px; right: 15px;
    color: #ff0; font-size: 18px; text-shadow: 0 0 8px #ff0; z-index: 10; }

  #start-screen, #game-over {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0.85); color: #0f0;
    font-size: 32px; display: flex;
    flex-direction: column; justify-content: center; align-items: center;
    text-align: center; z-index: 20; backdrop-filter: blur(4px);
    transition: opacity 1s; text-shadow: 0 0 10px #0f0;
  }
  #game-over { display: none; }

  button {
    margin-top: 20px; padding: 12px 30px;
    font-family: inherit; font-size: 20px;
    background: #000; color: #0f0; border: 2px solid #0f0;
    cursor: pointer; text-shadow: 0 0 8px #0f0;
    box-shadow: 0 0 20px #0f0; transition: all .3s;
  }
  button:hover {
    background: #0f0; color: #000;
    box-shadow: 0 0 30px #0f0, inset 0 0 20px #000;
  }

  .pulse { animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }

  /* hide cursor only when the game is running */
  .playing { cursor: none; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="hud">ALT: <span id="alt">0000</span>ft | SPD: <span id="spd">000</span>kt | FUEL: <span id="fuel">100</span>%</div>
<div id="score">SCORE: <span id="points">0</span></div>

<div id="start-screen">
  <h1 class="pulse">SKY ODYSSEY</h1>
  <p>Move your mouse to fly. Collect fuel. Avoid storms.</p>

  <label style="margin-top:15px; font-size:18px;">
    <input type="file" id="plane-upload" accept="image/*" style="display:none;">
    <button type="button" id="upload-btn" style="margin:0; padding:8px 20px; font-size:16px;">
      Upload Plane Image
    </button>
  </label>

  <button id="start-btn">LAUNCH</button>
</div>

<div id="game-over">
  <h1>MISSION FAILED</h1>
  <p>Final Score: <span id="final-score">0</span></p>
  <button id="restart-btn">TRY AGAIN</button>
</div>

<script>
/* ---------- Canvas & HUD ---------- */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;

const hud = {
  alt: document.getElementById('alt'),
  spd: document.getElementById('spd'),
  fuel: document.getElementById('fuel'),
  points: document.getElementById('points')
};

const screens = {
  start: document.getElementById('start-screen'),
  over: document.getElementById('game-over'),
  final: document.getElementById('final-score')
};

/* ---------- Plane Image (default + upload) ---------- */
let planeImg = new Image();
planeImg.src = 'https://na-assets.pinit.io/8GwrpeSH4TpAGEJsmoF35J8DY6RNCdyjCBZsEnTySEKd/c746a7a7-88cc-4677-b919-877329e2dd0d/437';
planeImg.crossOrigin = 'anonymous';

const uploadInput = document.getElementById('plane-upload');
const uploadBtn   = document.getElementById('upload-btn');

uploadBtn.onclick = () => uploadInput.click();
uploadInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  const img = new Image();
  img.onload = () => {
    planeImg = img;               // replace the plane sprite
    URL.revokeObjectURL(url);
  };
  img.src = url;
};

/* ---------- Game State ---------- */
let game = {
  running: false,
  score: 0, altitude: 3000, speed: 180, fuel: 100,
  mouseX: canvas.width/2, mouseY: canvas.height/2,
  plane: { x: canvas.width/2, y: canvas.height/2, rot: 0 },
  clouds: [], storms: [], fuels: [], particles: [], stars: []
};

/* ---------- Stars (parallax) ---------- */
for (let i=0;i<200;i++) {
  game.stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    size: Math.random()*2,
    speed: 0.5 + Math.random()
  });
}

/* ---------- Spawn helpers ---------- */
function spawnCloud() {
  game.clouds.push({
    x: canvas.width + 200,
    y: Math.random()*(canvas.height-200)+100,
    size: 80 + Math.random()*120,
    speed: 0.5 + Math.random()*1.5,
    puff: Math.random() > .5
  });
}
function spawnStorm() {
  if (Math.random() < .3) {
    game.storms.push({
      x: canvas.width + 300,
      y: Math.random()*(canvas.height-400)+200,
      size: 150 + Math.random()*100,
      speed: 2 + Math.random()*3,
      lightning: 0
    });
  }
}
function spawnFuel() {
  if (Math.random() < .4) {
    game.fuels.push({
      x: canvas.width + 100,
      y: Math.random()*(canvas.height-100)+50,
      size: 40,
      speed: 3,
      rot: 0
    });
  }
}

/* ---------- Particles ---------- */
function createParticles(x,y,color='#ff0',count=8){
  for(let i=0;i<count;i++){
    game.particles.push({
      x,y,
      vx:(Math.random()-.5)*8,
      vy:(Math.random()-.5)*8,
      life:30,
      color,
      size:2+Math.random()*3
    });
  }
}

/* ---------- Controls ---------- */
canvas.addEventListener('mousemove', e=>{
  if (game.running) {
    game.mouseX = e.clientX;
    game.mouseY = e.clientY;
  }
});

/* ---------- UI Buttons ---------- */
document.getElementById('start-btn').onclick = () => {
  screens.start.style.opacity = '0';
  setTimeout(()=>{ screens.start.style.display='none'; startGame(); },500);
};
document.getElementById('restart-btn').onclick = () => {
  screens.over.style.display='none';
  resetGame(); startGame();
};

function resetGame(){
  game = {
    running:true, score:0, altitude:3000, speed:180, fuel:100,
    mouseX:canvas.width/2, mouseY:canvas.height/2,
    plane:{x:canvas.width/2, y:canvas.height/2, rot:0},
    clouds:[], storms:[], fuels:[], particles:[],
    stars: game.stars
  };
  hud.points.textContent='0';
  hud.fuel.textContent='100';
}
function startGame(){
  game.running = true;
  document.body.classList.add('playing');   // hide cursor
  gameLoop();
  setInterval(spawnCloud,800);
  setInterval(spawnStorm,4000);
  setInterval(spawnFuel,3000);
}

/* ---------- Main Loop ---------- */
function gameLoop(){
  if (!game.running) return;

  // ----- background -----
  ctx.fillStyle = '#001122';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // ----- stars -----
  game.stars.forEach(s=>{
    s.x -= s.speed * (game.speed/200);
    if (s.x < 0) s.x = canvas.width;
    ctx.fillStyle = '#fff';
    ctx.globalAlpha = s.size>1?1:0.6;
    ctx.fillRect(s.x,s.y,s.size,s.size);
  });
  ctx.globalAlpha = 1;

  // ----- plane movement -----
  const dx = game.mouseX - game.plane.x;
  const dy = game.mouseY - game.plane.y;
  game.plane.x += dx * 0.08;
  game.plane.y += dy * 0.08;
  game.plane.rot = Math.atan2(dy,dx)*0.8;

  // ----- altitude / speed / fuel -----
  const targetAlt = Math.max(1000, Math.min(8000, (canvas.height - game.plane.y)*15));
  game.altitude += (targetAlt - game.altitude)*0.02;
  game.speed = 150 + (8000 - game.altitude)*0.03;
  game.fuel = Math.max(0, game.fuel - 0.015 - (game.speed>300?0.03:0));

  // ----- HUD -----
  hud.alt.textContent = Math.round(game.altitude);
  hud.spd.textContent = Math.round(game.speed);
  hud.fuel.textContent = Math.round(game.fuel);
  hud.points.textContent = game.score;

  // ----- draw plane -----
  ctx.save();
  ctx.translate(game.plane.x, game.plane.y);
  ctx.rotate(game.plane.rot);
  if (planeImg.complete && planeImg.naturalHeight !== 0) {
    ctx.drawImage(planeImg, -60, -40, 120, 80);
  } else {
    ctx.font = '60px Arial';
    ctx.fillStyle = '#fff';
    ctx.fillText('Plane', -30, 10);
  }
  ctx.restore();

  // ----- clouds -----
  game.clouds = game.clouds.filter(c=>{
    c.x -= c.speed * (game.speed/200);
    if (c.x < -300) return false;

    ctx.globalAlpha = 0.7;
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.ellipse(c.x, c.y, c.size, c.size*0.6, 0,0,Math.PI*2);
    ctx.fill();
    if (c.puff){
      ctx.beginPath(); ctx.ellipse(c.x-c.size*0.4,c.y,c.size*0.7,c.size*0.5,0,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(c.x+c.size*0.4,c.y,c.size*0.7,c.size*0.5,0,0,Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;

    if (Math.hypot(c.x-game.plane.x, c.y-game.plane.y) < c.size){
      game.score += 10;
      createParticles(c.x,c.y,'#0ff');
      return false;
    }
    return true;
  });

  // ----- storms -----
  game.storms.forEach((s,i)=>{
    s.x -= s.speed * (game.speed/200);
    s.lightning = Math.max(0, s.lightning-1);
    if (Math.random()<0.02) s.lightning = 15;

    ctx.globalAlpha = 0.6;
    ctx.fillStyle = '#444';
    ctx.beginPath();
    ctx.ellipse(s.x,s.y,s.size,s.size*0.8,0,0,Math.PI*2);
    ctx.fill();

    if (s.lightning>0){
      ctx.globalAlpha = s.lightning/15;
      ctx.strokeStyle = '#ff0';
      ctx.lineWidth = 3;
      for(let j=0;j<3;j++){
        ctx.beginPath();
        ctx.moveTo(s.x+(Math.random()-.5)*s.size, s.y);
        ctx.lineTo(s.x+(Math.random()-.5)*s.size*1.5, s.y+(Math.random()-.5)*s.size);
        ctx.stroke();
      }
    }
    ctx.globalAlpha = 1;

    if (Math.hypot(s.x-game.plane.x, s.y-game.plane.y) < s.size*0.8){
      game.fuel -= 20;
      createParticles(game.plane.x, game.plane.y, '#f00',15);
      game.storms.splice(i,1);
    }
  });

  // ----- fuel cans -----
  game.fuels = game.fuels.filter(f=>{
    f.x -= f.speed * (game.speed/200);
    f.rot += 0.1;
    if (f.x < -100) return false;

    ctx.save();
    ctx.translate(f.x,f.y);
    ctx.rotate(f.rot);
    ctx.fillStyle = '#ff0';
    ctx.fillRect(-f.size/2,-f.size/2,f.size,f.size);
    ctx.fillStyle = '#0c0';
    ctx.fillRect(-f.size/3,-f.size/3,f.size/1.5,f.size/1.5);
    ctx.restore();

    if (Math.hypot(f.x-game.plane.x, f.y-game.plane.y) < 50){
      game.fuel = Math.min(100, game.fuel+25);
      game.score += 50;
      createParticles(f.x,f.y,'#0f0',12);
      return false;
    }
    return true;
  });

  // ----- particles -----
  game.particles = game.particles.filter(p=>{
    p.x += p.vx; p.y += p.vy; p.vy += .2; p.life--;
    ctx.globalAlpha = p.life/30;
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x,p.y,p.size,p.size);
    return p.life > 0;
  });
  ctx.globalAlpha = 1;

  // ----- game over -----
  if (game.fuel <= 0 || game.altitude < 500){
    game.running = false;
    document.body.classList.remove('playing'); // show cursor again
    screens.final.textContent = game.score;
    setTimeout(()=>{ screens.over.style.display='flex'; },1000);
  }

  requestAnimationFrame(gameLoop);
}

/* ---------- Resize ---------- */
window.addEventListener('resize',()=>{
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});

/* ---------- Initial clouds ---------- */
for(let i=0;i<15;i++) spawnCloud();
</script>
</body>
</html>
