<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Chat • Cloudflare Workers</title>
  <style>
    :root { --bg: #f8f9fa; --user: #d4edff; --ai: #f0f0f0; }
    body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; color: #333; }
    #chat { 
      height: 70vh; overflow-y: auto; border: 1px solid #ddd; border-radius: 12px; 
      padding: 16px; background: white; margin-bottom: 16px; display: flex; flex-direction: column; gap: 12px;
    }
    .message { padding: 12px 16px; border-radius: 12px; max-width: 80%; line-height: 1.5; }
    .user { align-self: flex-end; background: var(--user); border-bottom-right-radius: 4px; }
    .ai   { align-self: flex-start; background: var(--ai); border-bottom-left-radius: 4px; }
    .input-area { display: flex; gap: 10px; }
    textarea { flex: 1; padding: 14px; border: 1px solid #ccc; border-radius: 12px; font-size: 16px; resize: none; }
    button { padding: 0 24px; background: #0066ff; color: white; border: none; border-radius: 12px; font-size: 16px; cursor: pointer; }
    button:disabled { background: #999; cursor: not-allowed; }
    .typing { opacity: 0.7; font-style: italic; }
  </style>
</head>
<body>
  <div class="container">
    <h1>My AI Chat</h1>
    <div id="chat"></div>
    <div class="input-area">
      <textarea id="input" placeholder="Ask me anything..." rows="2"></textarea>
      <button id="send">Send</button>
    </div>
  </div>

  <script>
    // CHANGE THIS TO YOUR WORKER URL
    const WORKER_URL = "https://kaijo.brandonmanus15.workers.dev";

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    let messages = [
      { role: "system", content: "You are a helpful, friendly AI assistant." }
    ];

    function addMessage(role, content = "", typing = false) {
      const div = document.createElement("div");
      div.className = `message ${role}`;
      if (typing) div.classList.add("typing");
      div.textContent = content;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;

      addMessage("user", userText);
      messages.push({ role: "user", content: userText });
      input.value = "";
      sendBtn.disabled = true;

      const aiMessageDiv = addMessage("ai", "▌", true); // typing indicator

      const response = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages })
      });

      if (!response.ok) {
        aiMessageDiv.textContent = "Error: Could not reach the AI worker.";
        sendBtn.disabled = false;
        return;
      }

      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let aiText = "";

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value);
        const lines = chunk.split("\n");
        for (const line of lines) {
          if (line.startsWith("data: ")) {
            const data = line.slice(6);
            if (data === "[DONE]") continue;
            try {
              const json = JSON.parse(data);
              aiText += json.response || "";
              aiMessageDiv.textContent = aiText + "▌";
            } catch (e) {}
          }
        }
      }

      aiMessageDiv.textContent = aiText;
      aiMessageDiv.classList.remove("typing");
      messages.push({ role: "assistant", content: aiText });
      sendBtn.disabled = false;
      input.focus();
    }

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Start with a welcome message
    addMessage("ai", "Hello! I'm your Kaijo powered by Cloudflare Workers with a little twist in my code. How can I help you today?");
  </script>
</body>
</html>
