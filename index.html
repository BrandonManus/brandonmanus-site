<!DOCTYPE html>
<html lang="en">
<head>
<script>
  if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
    window.location.href = "mobile.html";
  }
</script>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
<title>Cybernetic Node v4.0</title>
<style>
  :root {
    --accent: #00ff88;
    --accent-soft: rgba(0, 255, 136, 0.4);
    --accent-alt: #00ffea;
    --bg: #000000;
    --terminal-bg: rgba(0, 0, 0, 0.85);
    --border-soft: rgba(0, 255, 136, 0.4);
  }

  * { box-sizing: border-box; }

  body, html {
    margin:0; padding:0; height:100%; overflow:hidden;
    background: radial-gradient(circle at top, #021b0a 0%, #000 55%, #000 100%);
    color:#0f0; font-family:'Orbitron', monospace;
  }

  /* ------------------------------------------------------------------ */
  /* LOGIN (unchanged) */
  /* ------------------------------------------------------------------ */
  #loginOverlay { … }

  /* ------------------------------------------------------------------ */
  /* MAIN LAYOUT */
  /* ------------------------------------------------------------------ */
  #mainContent { display:none; position:relative; height:100%; width:100%; overflow:hidden; }
  #matrixCanvas, #particleCanvas { position:absolute; inset:0; width:100%; height:100%; }
  #matrixCanvas { z-index:0; opacity:0.26; pointer-events:none; }
  #particleCanvas { z-index:1; pointer-events:none; }

  /* ------------------------------------------------------------------ */
  /* AVATAR – tighter vertical rhythm & smaller label */
  /* ------------------------------------------------------------------ */
  #avatarContainer {
    position:absolute;
    top:10%;                     /* keep original top */
    left:50%; transform:translateX(-50%);
    z-index:3; opacity:0;
    transition:opacity 1.2s ease-in-out, transform 0.8s ease-out;
    display:flex; flex-direction:column; align-items:center;
    gap:2px;                     /* FIX: reduced from 6px */
  }
  #avatarContainer.active { transform:translateX(-50%) translateY(0); }

  #avatarImg {
    width:260px; height:260px;
    border-radius:50%; border:3px solid var(--accent);
    box-shadow:0 0 35px var(--accent), 0 0 80px rgba(0,255,136,0.55), inset 0 0 22px rgba(0,255,0,0.35);
    transition:transform .6s ease, box-shadow .6s ease, filter .6s ease;
    object-fit:cover; animation:avatarPulse 3.5s ease-in-out infinite;
    backdrop-filter:blur(3px);
  }
  #avatarContainer:hover #avatarImg { … }

  .avatar-ring { … }

  .avatar-label {
    font-size:0.68rem;           /* FIX: smaller, lighter */
    text-transform:uppercase;
    letter-spacing:0.18em;
    color:rgba(0,255,136,0.55);
    margin-top:4px;              /* FIX: tiny top margin */
  }

  @keyframes avatarPulse { … }
  @keyframes ringSpin { … }

  /* ------------------------------------------------------------------ */
  /* DISPLAY TEXT – tighter padding */
  /* ------------------------------------------------------------------ */
  #displayText {
    position:absolute;
    top:47%; left:50%; transform:translateX(-50%);
    color:var(--accent); font-size:1.05em; white-space:pre-line;
    z-index:3; text-align:center;
    text-shadow:0 0 12px rgba(0,255,136,0.6);
    padding:4px 12px;            /* FIX: reduced from 6px 14px */
    background:linear-gradient(to right, rgba(0,0,0,0.9), rgba(0,0,0,0.6), rgba(0,0,0,0.9));
    border-radius:4px; border:1px solid rgba(0,255,136,0.3);
    max-width:80%;
  }

  /* ------------------------------------------------------------------ */
  /* TERMINAL – cursor blink + input width */
  /* ------------------------------------------------------------------ */
  #terminal {
    position:absolute;
    bottom:23%; left:50%; transform:translateX(-50%);
    background:var(--terminal-bg); border:1px solid var(--border-soft);
    padding:10px; width:90%; max-width:650px;
    color:#0f0; font-family:monospace; font-size:14px;
    display:none; z-index:6;
    box-shadow:0 0 25px rgba(0,255,136,0.25);
    border-radius:6px; backdrop-filter:blur(3px);
  }
  #terminal::before { … }

  #terminalOutput { … }

  #terminalInput {
    width:92%;                   /* FIX: slightly narrower to centre the prompt */
    background:#000; color:#0f0; border:none; outline:none;
  }

  #terminalPrompt {
    color:var(--accent);
    animation:blink 1s step-end infinite;   /* FIX: blinking cursor */
  }
  @keyframes blink { 0%,50% { opacity:1; } 51%,100% { opacity:0; } }

  /* ------------------------------------------------------------------ */
  /* CRYPTO DASHBOARD – consistent formatting + error handling */
  /* ------------------------------------------------------------------ */
  .crypto-dashboard-wrapper {
    position:absolute; bottom:4%; left:50%; transform:translateX(-50%); z-index:5;
  }
  .crypto-dashboard-container {
    display:flex; gap:22px; justify-content:center; flex-wrap:wrap;
    font-family:'Orbitron', sans-serif;
  }
  .crypto-card { … }

  .crypto-card .price {
    font-size:1.5em; font-weight:bold; margin:0;
  }
  .crypto-card .label { … }

  /* ------------------------------------------------------------------ */
  /* RESPONSIVE TWEAKS */
  /* ------------------------------------------------------------------ */
  @media (max-width: 768px) { … }
</style>
</head>
<body>

<div id="loginOverlay"> … </div>

<div id="mainContent">
  <canvas id="matrixCanvas"></canvas>
  <canvas id="particleCanvas"></canvas>

  <div id="avatarContainer">
    <div class="avatar-ring"></div>
    <img id="avatarImg" src="https://na-assets.pinit.io/8GwrpeSH4TpAGEJsmoF35J8DY6RNCdyjCBZsEnTySEKd/c746a7a7-88cc-4677-b919-877329e2dd0d/437" />
    <div class="avatar-label">Cybernetic Identity: LINKED</div>
  </div>

  <div id="displayText">Initializing Neural Link...</div>

  <div id="terminal">
    <div id="terminalOutput"></div>
    <div>
      <span id="terminalPrompt">&gt;</span>
      <input id="terminalInput" type="text" autocomplete="off"/>
    </div>
  </div>

  <div class="crypto-dashboard-wrapper">
    <div id="crypto-dashboard" class="crypto-dashboard-container">
      <div class="crypto-card" id="btc-card">
        <h2>BTC</h2>
        <p class="price">$0</p>
        <div class="label">Core Signal</div>
      </div>
      <div class="crypto-card" id="eth-card">
        <h2>ETH</h2>
        <p class="price">$0</p>
        <div class="label">Relay Flux</div>
      </div>
      <div class="crypto-card" id="sol-card">
        <h2>SOL</h2>
        <p class="price">$0</p>
        <div class="label">Solar Thread</div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  /* ------------------------------------------------------------------ */
  /* … (all the original JS stays the same) … */
  /* ------------------------------------------------------------------ */

  // CRYPTO – robust fetch + consistent formatting
  async function fetchCrypto() {
    try {
      const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
      if (!res.ok) throw new Error('API error');
      const data = await res.json();

      // Always show whole dollars, add commas, keep 2-decimal for < $1k if you want
      const formatPrice = (price) => {
        const num = Number(price);
        return `$${num.toLocaleString('en-US', {minimumFractionDigits:0, maximumFractionDigits:0})}`;
      };

      document.querySelector('#btc-card .price').textContent = formatPrice(data.bitcoin.usd);
      document.querySelector('#eth-card .price').textContent = formatPrice(data.ethereum.usd);
      document.querySelector('#sol-card .price').textContent = formatPrice(data.solana.usd);
    } catch (err) {
      console.warn('Crypto fetch failed:', err);
      // Show a friendly “—” instead of “$Err” and keep the UI clean
      document.querySelectorAll('.crypto-card .price').forEach(p => p.textContent = '—');
    }
  }

  /* ------------------------------------------------------------------ */
  /* … rest of the original script (matrix, particles, terminal, etc.) … */
  /* ------------------------------------------------------------------ */

  // start everything after boot
  function bootSequence() {
    const messages = [
      `User ${username} recognized...`,
      "Decrypting neural matrix...",
      "Stabilizing data stream...",
      "Neural link established.",
      "Type help for more info"
    ];
    let i = 0;
    function typeNext() {
      if (i >= messages.length) {
        avatar.style.opacity = 1;
        avatar.classList.add('active');
        terminal.style.display = 'block';
        terminalInput.focus();
        startMatrix();
        startParticles();
        fetchCrypto();                // first fetch
        setInterval(fetchCrypto, 8000); // slower interval → less rate-limit risk
        return;
      }
      let j = 0;
      displayText.textContent = "";
      function typer() {
        if (j < messages[i].length) {
          displayText.textContent += messages[i][j++];
          setTimeout(typer, 30);
        } else {
          i++;
          setTimeout(typeNext, 500);
        }
      }
      typer();
    }
    typeNext();
  }

  /* ------------------------------------------------------------------ */
  /* (the rest of your original JS – unchanged) */
  /* ------------------------------------------------------------------ */
});
</script>
</body>
</html>
